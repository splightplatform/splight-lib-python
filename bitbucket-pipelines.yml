image: python:3.8
pipelines:
  default:
    - step:
        name: unit testing
        size: 1x
        script:
          - python setup.py install
          - python manage.py test
        trigger: automatic
  branches:
    master: &shared
      - step:
          name: upload library to jfrog
          script:
            - printf "[distutils]\nindex-servers=splightlib\n[splightlib]\nrepository:https://splight.jfrog.io/artifactory/api/pypi/testjfrog-pypi\nusername=bot@splight-ae.com\npassword=N0us4rExcl4maci0n" >> ~/.pypirc
            - python setup.py bdist_wheel upload -r splightlib
            - rm ~/.pypirc;
    main: *shared
